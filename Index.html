<!DOCTYPE html>
<html>
<head>
  <title>C & C Partner Portal</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f7f9fc; }
    h1 { color: #2b4c7e; }
    .box { background: #fff; border: 1px solid #ccc; padding: 20px; width: 400px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    input, button { display: block; margin: 10px 0; padding: 10px; width: 95%; border-radius: 5px; border: 1px solid #ccc; }
    button { background: #2b4c7e; color: white; cursor: pointer; font-weight: bold; }
    button:hover { background: #3d67a8; }
    #portal { display: none; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    th { background: #2b4c7e; color: white; }
    tr:nth-child(even) { background: #f2f2f2; }
    #results { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>C & C Professional Housing Solutions Partner Portal</h1>

  <div id="login" class="box">
    <h3>Login</h3>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>

  <div id="portal" class="box">
    <h3>Search Housing</h3>
    <input id="city" placeholder="Enter City">
    <button onclick="search()">Search</button>
    <div id="results"></div>
  </div>

<script>
async function login() {
  const res = await fetch("/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username: document.getElementById("username").value })
  });

  if (res.ok) {
    document.getElementById("login").style.display = "none";
    document.getElementById("portal").style.display = "block";
  } else {
    alert("Login failed");
  }
}

async function search() {
  const city = document.getElementById("city").value;
  const res = await fetch("/assets?city=" + encodeURIComponent(city));
  const data = await res.json();

  if (!Array.isArray(data) || data.length === 0) {
    document.getElementById("results").innerHTML = `<p>No assets found in ${city}.</p>`;
    return;
  }

  let html = "<table><tr><th>Asset Name</th><th>Tag</th><th>Location</th><th>Status</th></tr>";
  data.forEach(a => {
    html += `<tr>
      <td>${a.name || "—"}</td>
      <td>${a.asset_tag || "—"}</td>
      <td>${a.location?.name || city}</td>
      <td>${a.status_label?.name || "—"}</td>
    </tr>`;
  });
  html += "</table>";
  document.getElementById("results").innerHTML = html;
}
</script>
</body>
</html>
